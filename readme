optimized for both smaller size and performance using gcc compiler flags magic.
